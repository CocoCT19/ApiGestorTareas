<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestor de Proyectos</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        input, button { padding: 10px; margin: 5px 0; width: 100%; }
        textarea { width: 100%; height: 60px; }
        .box { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>

<h1>Panel API – Proyectos y Tareas</h1>

<script>
    const BASE_URL = "http://localhost:8000/api";
    let TOKEN = localStorage.getItem("token") ?? "";
</script>

<!-- REGISTRO -->
<div class="box">
    <h2>Registro</h2>
    <input id="reg_name" placeholder="Nombre">
    <input id="reg_email" placeholder="Email">
    <input id="reg_pass" placeholder="Contraseña" type="password">
    <input id="reg_pass2" placeholder="Confirmar" type="password">
    <button onclick="register()">Registrarse</button>
    <p id="reg_msg"></p>
</div>

<!-- LOGIN -->
<div class="box">
    <h2>Login</h2>
    <input id="log_email" placeholder="Email">
    <input id="log_pass" placeholder="Contraseña" type="password">
    <button onclick="login()">Entrar</button>
    <p id="log_msg"></p>
</div>

<!-- CREAR PROYECTO -->
<div class="box">
    <h2>Crear Proyecto</h2>
    <input id="proj_title" placeholder="Título">
    <textarea id="proj_desc" placeholder="Descripción"></textarea>
    <button onclick="createProject()">Crear Proyecto</button>
    <p id="proj_msg"></p>
</div>

<!-- LISTAR PROYECTOS -->
<div class="box">
    <h2>Proyectos</h2>
    <button onclick="loadProjects()">Cargar Lista</button>
    <pre id="projects_list"></pre>
</div>

<!-- CREAR TAREA -->
<div class="box">
    <h2>Crear Tarea</h2>
    <input id="task_project_id" placeholder="ID del Proyecto">
    <input id="task_title" placeholder="Título">
    <textarea id="task_desc" placeholder="Descripción"></textarea>
    <button onclick="createTask()">Crear Tarea</button>
    <p id="task_msg"></p>
</div>

<!-- LISTAR TAREAS -->
<div class="box">
    <h2>Tareas</h2>
    <input id="task_project_id2" placeholder="ID del Proyecto">
    <button onclick="loadTasks()">Cargar Tareas</button>
    <pre id="tasks_list"></pre>
</div>

<script>

async function register() {
    const res = await fetch(`${BASE_URL}/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            name: reg_name.value,
            email: reg_email.value,
            password: reg_pass.value,
            password_confirmation: reg_pass2.value
        })
    });
    reg_msg.textContent = (await res.text());
}

async function login() {
    const res = await fetch(`${BASE_URL}/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            email: log_email.value,
            password: log_pass.value
        })
    });

    const data = await res.json();

    if (data.token) {
        TOKEN = data.token;
        localStorage.setItem("token", TOKEN);
        log_msg.textContent = "Login exitoso ✔";
    } else {
        log_msg.textContent = "Error: " + JSON.stringify(data);
    }
}

// ----- PROYECTOS -----

async function createProject() {
    const res = await fetch(`${BASE_URL}/projects`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + TOKEN
        },
        body: JSON.stringify({
            title: proj_title.value,
            description: proj_desc.value
        })
    });

    proj_msg.textContent = await res.text();
}

async function loadProjects() {
    const res = await fetch(`${BASE_URL}/projects`, {
        headers: { "Authorization": "Bearer " + TOKEN }
    });

    projects_list.textContent = JSON.stringify(await res.json(), null, 2);
}

// ----- TAREAS -----

async function createTask() {
    const res = await fetch(`${BASE_URL}/tasks`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + TOKEN
        },
        body: JSON.stringify({
            project_id: task_project_id.value,
            title: task_title.value,
            description: task_desc.value
        })
    });

    task_msg.textContent = await res.text();
}

async function loadTasks() {
    const res = await fetch(`${BASE_URL}/tasks?project_id=` + task_project_id2.value, {
        headers: { "Authorization": "Bearer " + TOKEN }
    });

    tasks_list.textContent = JSON.stringify(await res.json(), null, 2);
}

</script>

</body>
</html>
